name: Update Discord Presence

on:
  schedule:
    - cron: '*/5 * * * *'  # Chạy mỗi 5 phút
  workflow_dispatch:  # Cho phép chạy thủ công từ giao diện GitHub

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Thêm quyền ghi để có thể push thay đổi
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'
          
      - name: Create package.json if not exists
        run: |
          if [ ! -f package.json ]; then
            echo '{"name":"discord-updater","version":"1.0.0","private":true}' > package.json
          fi
          
      - name: Install Dependencies
        run: npm install node-fetch@2
          
      - name: Update README with Discord Info
        run: node .github/scripts/update_discord.js
        env:
          TZ: 'Asia/Ho_Chi_Minh'  # Đặt múi giờ Việt Nam
        
      - name: Commit and Push if Changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add README.md
          git diff --quiet && git diff --staged --quiet || git commit -m "Update Discord presence [Automated]"
          git push 